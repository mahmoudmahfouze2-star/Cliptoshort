<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClipToShort - Upload Short Generator</title>

<!-- FFmpeg -->
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

<style>

/* ===== Reset ===== */
*{
box-sizing:border-box;
margin:0;
padding:0;
}

body{
background:#0f0f14;
color:white;
font-family:Arial, sans-serif;
padding:20px;
}

h1{
color:#7c3aed;
text-align:center;
margin-bottom:20px;
}

.main-wrapper{
display:flex;
justify-content:center;
align-items:flex-start;
gap:25px;
max-width:1400px;
margin:0 auto;
}

.container{
flex:1;
max-width:850px;
text-align:center;
}

.sidebar{
width:300px;
display:none;
}

@media(min-width:1024px){
.sidebar{
display:block;
}
}

.ad-box{
background:#1f1f2e;
padding:15px;
margin:20px auto;
border-radius:12px;
text-align:center;
min-height:90px;
display:flex;
justify-content:center;
align-items:center;
}

input, select{
padding:12px;
margin:10px 0;
width:90%;
max-width:400px;
border-radius:8px;
border:none;
outline:none;
font-size:15px;
}

button{
padding:12px 28px;
margin:15px 10px;
background:#7c3aed;
color:white;
border:none;
border-radius:10px;
cursor:pointer;
font-size:16px;
transition:0.3s;
}

button:hover{
background:#22d3ee;
}

.video-grid{
display:flex;
flex-wrap:wrap;
gap:20px;
justify-content:center;
margin-top:25px;
}

.video-box{
background:#1f1f2e;
padding:15px;
border-radius:12px;
width:260px;
}

video{
width:100%;
border-radius:10px;
}

.status{
font-weight:bold;
margin-top:15px;
}

.download-btn{
display:inline-block;
margin-top:12px;
padding:10px 18px;
background:#22c55e;
color:white;
border-radius:8px;
text-decoration:none;
font-weight:bold;
}

@media(max-width:768px){
.main-wrapper{
flex-direction:column;
align-items:center;
}
.video-box{
width:100%;
max-width:350px;
}
}

</style>

</head>

<body>

<h1>ClipToShort</h1>

<div class="ad-box">
    <!-- Top Banner Place -->
</div>

<div class="main-wrapper">

<div class="container">

<input type="file" id="videoInput" accept="video/*">
<p id="uploadStatus" class="status"></p>

<label>Short Duration</label>
<select id="duration">
<option value="15">15s</option>
<option value="30">30s</option>
<option value="60">60s</option>
</select>

<button id="generateBtn">Generate 3 Highlights</button>

<div class="video-grid" id="videoGrid"></div>

<div class="ad-box">
    <!-- Bottom Banner Place -->
</div>

</div>

<div class="sidebar">
<div class="ad-box">
    <!-- Sidebar Banner -->
</div>
</div>

</div>

<script>

const ffmpeg = FFmpeg.createFFmpeg({ log: false });
const fetchFile = FFmpeg.fetchFile;

let input = document.getElementById("videoInput");
let statusText = document.getElementById("uploadStatus");
let generateBtn = document.getElementById("generateBtn");
let videoGrid = document.getElementById("videoGrid");

let uploadedFile = null;
let popTriggered = false;

input.addEventListener("change", function(){
uploadedFile = input.files[0];
if(uploadedFile){
statusText.innerText = "Video Ready âœ…";
statusText.style.color = "#22c55e";
}
});

generateBtn.addEventListener("click", async function(){

// ðŸ”¥ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·
if(!popTriggered){
let s = document.createElement("script");
s.src = "https://pl28740452.effectivegatecpm.com/fe/db/f8/fedbf860db1331095f6a009604f1919d.js";
document.body.appendChild(s);
popTriggered = true;
}

await generateHighlights();

});

async function generateHighlights(){

if(!uploadedFile){
alert("Upload video first");
return;
}

statusText.innerText = "Processing video...";
statusText.style.color = "#facc15";

const tempVideo = document.createElement("video");
tempVideo.src = URL.createObjectURL(uploadedFile);
await tempVideo.play().catch(()=>{});
tempVideo.pause();

const totalDuration = Math.floor(tempVideo.duration);
const shortDuration = parseInt(document.getElementById("duration").value);

if(!ffmpeg.isLoaded()){
await ffmpeg.load();
}

ffmpeg.FS("writeFile", "input.mp4", await fetchFile(uploadedFile));
videoGrid.innerHTML = "";

let startPoints = [
Math.floor(totalDuration * 0.3),
Math.floor(totalDuration * 0.5),
Math.floor(totalDuration * 0.75)
];

for(let i=0;i<3;i++){

await ffmpeg.run(
"-ss", startPoints[i].toString(),
"-t", shortDuration.toString(),
"-i", "input.mp4",
"-vf", "scale=720:1280:force_original_aspect_ratio=increase,crop=720:1280",
"-c:v", "libx264",
"-preset", "fast",
"-crf", "23",
"-c:a", "aac",
"-b:a", "128k",
"output"+i+".mp4"
);

const data = ffmpeg.FS("readFile", "output"+i+".mp4");
const url = URL.createObjectURL(new Blob([data.buffer], { type: "video/mp4" }));

let box = document.createElement("div");
box.className = "video-box";

box.innerHTML = `
<video controls src="${url}"></video>
<a href="${url}" download="highlight_${i+1}.mp4" class="download-btn">
Download
</a>
`;

videoGrid.appendChild(box);
}

statusText.innerText = "3 Highlights Ready âœ…";
statusText.style.color = "#22c55e";

}

</script>

</body>
</html>
