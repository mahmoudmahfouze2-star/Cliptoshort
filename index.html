<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClipToShort - 3 Reels Generator</title>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;}

body{
background:#0f0f14;
color:white;
font-family:Arial, sans-serif;
padding:20px;
text-align:center;
}

h1{
color:#7c3aed;
margin-bottom:20px;
}

input{
padding:12px;
margin:10px 0;
width:90%;
max-width:400px;
border-radius:8px;
border:none;
font-size:15px;
}

button{
padding:12px 28px;
margin:15px 10px;
background:#7c3aed;
color:white;
border:none;
border-radius:10px;
cursor:pointer;
transition:0.3s;
font-size:16px;
}

button:hover{background:#22d3ee;}

.video-grid{
display:flex;
flex-wrap:wrap;
gap:20px;
justify-content:center;
margin-top:25px;
}

.video-box{
background:#1f1f2e;
padding:15px;
border-radius:12px;
width:260px;
}

video{
width:100%;
border-radius:10px;
}

.status{
margin-top:15px;
font-weight:bold;
}

.download-btn{
display:inline-block;
margin-top:12px;
padding:10px 18px;
background:#22c55e;
color:white;
border-radius:8px;
text-decoration:none;
font-weight:bold;
}

</style>
</head>

<body>

<h1>ClipToShort</h1>

<input type="file" id="videoInput" accept="video/*">
<p id="uploadStatus" class="status"></p>

<button id="generateBtn">Generate 3 Reels (9:16) + Captions</button>

<div class="video-grid" id="videoGrid"></div>

<script>

const ffmpeg = FFmpeg.createFFmpeg({ log:true });
const fetchFile = FFmpeg.fetchFile;

let input = document.getElementById("videoInput");
let statusText = document.getElementById("uploadStatus");
let generateBtn = document.getElementById("generateBtn");
let videoGrid = document.getElementById("videoGrid");

let uploadedFile = null;

input.addEventListener("change", function(){
uploadedFile = input.files[0];
if(uploadedFile){
statusText.innerText = "Video Ready âœ…";
statusText.style.color = "#22c55e";
}
});

generateBtn.addEventListener("click", generateReels);

async function generateReels(){

if(!uploadedFile){
alert("Upload video first");
return;
}

statusText.innerText="Loading FFmpeg...";
statusText.style.color="#facc15";

if(!ffmpeg.isLoaded()){
await ffmpeg.load();
}

ffmpeg.FS("writeFile","input.mp4",await fetchFile(uploadedFile));

videoGrid.innerHTML="";

const tempVideo = document.createElement("video");
tempVideo.src = URL.createObjectURL(uploadedFile);
await tempVideo.play().catch(()=>{});
tempVideo.pause();

let totalDuration = Math.floor(tempVideo.duration);

let startPoints = [
Math.floor(totalDuration * 0.25),
Math.floor(totalDuration * 0.5),
Math.floor(totalDuration * 0.75)
];

let captions = [
"Ø£Ù‚ÙˆÙ‰ Ù„Ø­Ø¸Ø© ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ”¥",
"Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø¯Ù‡ ØºÙŠØ± ÙƒÙ„ Ø­Ø§Ø¬Ø© ğŸ˜±",
"Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù„ÙŠ Ù„Ø§Ø²Ù… ØªØ´ÙˆÙÙ‡ ğŸ‘€"
];

for(let i=0;i<3;i++){

statusText.innerText="Creating Reel " + (i+1);

await ffmpeg.run(
"-ss", startPoints[i].toString(),
"-t","30",
"-i","input.mp4",
"-vf","scale=720:1280:force_original_aspect_ratio=increase,crop=720:1280",
"-preset","ultrafast",
"reel"+i+".mp4"
);

let srt=`1
00:00:00,000 --> 00:00:30,000
${captions[i]}
`;

ffmpeg.FS("writeFile","sub"+i+".srt", new TextEncoder().encode(srt));

await ffmpeg.run(
"-i","reel"+i+".mp4",
"-vf","subtitles=sub"+i+".srt:force_style='FontSize=32,PrimaryColour=&H00FFFFFF,OutlineColour=&H00000000,BorderStyle=1,Outline=3'",
"-preset","ultrafast",
"final"+i+".mp4"
);

const data = ffmpeg.FS("readFile","final"+i+".mp4");
const url = URL.createObjectURL(new Blob([data.buffer],{type:"video/mp4"}));

let box = document.createElement("div");
box.className="video-box";

box.innerHTML=`
<video controls src="${url}"></video>
<a href="${url}" download="reel_${i+1}.mp4" class="download-btn">
Download
</a>
`;

videoGrid.appendChild(box);

}

statusText.innerText="3 Reels Ready âœ…";
statusText.style.color="#22c55e";

}

</script>

</body>
</html>
