<!DOCTYPE html>
<html lang="en">
<head>
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4250466001924394"
     crossorigin="anonymous"></script> 
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClipToShort - Upload Short Generator</title>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

<style>
body{
background:#0f0f14;
color:white;
font-family:Arial, sans-serif;
text-align:center;
margin:0;
padding:20px;
}

h1{ color:#7c3aed; }

.container{
max-width:900px;
margin:auto;
}

input, select{
padding:10px;
margin:10px;
width:90%;
border-radius:6px;
border:none;
}

button{
display:inline-block;
padding:10px 20px;
margin:10px;
background:#7c3aed;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
}

button:hover{
background:#22d3ee;
}

.video-grid{
display:flex;
flex-wrap:wrap;
gap:20px;
justify-content:center;
margin-top:20px;
}

.video-box{
background:#1f1f2e;
padding:15px;
border-radius:10px;
width:260px;
}

video{
width:100%;
border-radius:8px;
}

.status{
font-weight:bold;
margin-top:10px;
}
</style>
</head>

<body>

<h1>Smart Triple Highlight Generator</h1>

<div class="container">

<input type="file" id="videoInput" accept="video/*">
<p id="uploadStatus" class="status"></p>

<label>Short Duration</label>
<select id="duration">
<option value="15">15s</option>
<option value="30">30s</option>
<option value="60">60s</option>
</select>

<button id="generateBtn">Generate 3 Highlights</button>

<div class="video-grid" id="videoGrid"></div>

</div>

<script>
const ffmpeg = FFmpeg.createFFmpeg({ log: false });
const fetchFile = FFmpeg.fetchFile;

let input = document.getElementById("videoInput");
let statusText = document.getElementById("uploadStatus");
let generateBtn = document.getElementById("generateBtn");
let videoGrid = document.getElementById("videoGrid");

let uploadedFile = null;

input.addEventListener("change", function(){
    uploadedFile = input.files[0];
    if(uploadedFile){
        statusText.innerText = "Video Ready ✅";
    }
});

generateBtn.addEventListener("click", generateHighlights);

async function generateHighlights(){

    if(!uploadedFile){
        alert("Upload video first");
        return;
    }

    statusText.innerText = "Analyzing full video...";

    const tempVideo = document.createElement("video");
    tempVideo.src = URL.createObjectURL(uploadedFile);
    await tempVideo.play().catch(()=>{});
    tempVideo.pause();

    const totalDuration = Math.floor(tempVideo.duration);
    const shortDuration = parseInt(document.getElementById("duration").value);

    if(!ffmpeg.isLoaded()){
        await ffmpeg.load();
    }

    ffmpeg.FS("writeFile", "input.mp4", await fetchFile(uploadedFile));

    videoGrid.innerHTML = "";

    // نختار 3 نقاط موزعة عبر الفيديو
    let startPoints = [
        Math.floor(totalDuration * 0.3),
        Math.floor(totalDuration * 0.5),
        Math.floor(totalDuration * 0.75)
    ];

    for(let i=0;i<3;i++){

        statusText.innerText = "Generating highlight " + (i+1);

        await ffmpeg.run(
            "-ss", startPoints[i].toString(),
            "-t", shortDuration.toString(),
            "-i", "input.mp4",
            "-vf", "scale=720:1280:force_original_aspect_ratio=increase,crop=720:1280",
            "-c:v", "libx264",
            "-preset", "fast",
            "-crf", "23",
            "-c:a", "aac",
            "-b:a", "128k",
            "output"+i+".mp4"
        );

        const data = ffmpeg.FS("readFile", "output"+i+".mp4");
        const url = URL.createObjectURL(new Blob([data.buffer], { type: "video/mp4" }));

        let box = document.createElement("div");
        box.className = "video-box";

        box.innerHTML = `
            <video controls src="${url}"></video>
            <a href="${url}" download="highlight_${i+1}.mp4">
                <button>Download</button>
            </a>
        `;

        videoGrid.appendChild(box);
    }

    statusText.innerText = "3 Smart Highlights Ready ✅";
}
</script>

</body>
</html>
